import{r as t,h as e}from"./p-59902f89.js";import{c as i,R as s}from"./p-2f3d151d.js";const a=".app-home{padding:10px}button{background:#5851ff;color:white;margin:8px;border:none;font-size:13px;font-weight:700;text-transform:uppercase;padding:16px 20px;border-radius:2px;box-shadow:0 8px 16px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);outline:0;letter-spacing:0.04em;transition:all 0.15s ease;cursor:pointer}button:hover{box-shadow:0 3px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1);transform:translateY(1px)}";const o=a;const n=class{constructor(e){t(this,e);this.API_URL="http://localhost:2989";this.currentDisplayItem=undefined;this.currentCategoryId=1;this.items=undefined;this.rootCategories=undefined;this.renderLimit=200}async componentWillLoad(){}setLookUpItem(t){const e=this.items.find((e=>e.id==t));if(e){this.currentDisplayItem=e}}async fetchFromApi(t){const e=await fetch(this.API_URL+t);if(!e.ok){throw new Error(`HTTP error! Status: ${e.status}`)}return await e.json()}sortByPercentageVariation(){this.items=[...this.items].sort(((t,e)=>{const i=this.calculatePercentageVariation(t);const s=this.calculatePercentageVariation(e);return s-i}))}calculatePercentageVariation(t){if(t.averagePrices.length<2)return 0;const e=t.averagePrices.map((t=>t.averagePrice));const i=e[e.length-1];const s=e[e.length-2];if(s===0)return 0;return(i-s)/s*100}render(){return e("div",{key:"916b1af239eae2df088c8389b2a4c2ba1d095ad2",class:"app-home"},e("item-recipe-component",{key:"abf0434769c822b094a1401ac3ce45ccca8a67bb"}))}};n.style=o;const c=i();const r="header{background:#5851ff;color:white;height:56px;display:flex;align-items:center;box-shadow:0 2px 5px 0 rgba(0, 0, 0, 0.26)}h1{font-size:1.4rem;font-weight:500;color:#fff;padding:0 12px;cursor:pointer}";const l=r;const h=class{constructor(e){t(this,e)}render(){return e("div",{key:"ad32abb419c44f9e2dcfa9570dae46f95281748b"},e("header",{key:"bf4e614b7c9121dcc46fde55baebbe37b8e76ecc"},e("h1",{key:"34e2ca1c120f2be7a7b328b5f767abd545539a67",onClick:()=>c.push("/")},"Stencil App Starter")),e("main",{key:"ed21ac7dd32c9868108aa58ec380b725cfce4125"},e(c.Switch,{key:"f1001729396352d2d558afa5cac86dcdfc60f877"},e(s,{key:"973c3c4e89c5720893f65355eb9fc343ece6aa08",path:"/"},e("app-home",{key:"a1055f9916c9ce6226e9de687a5a2b954faad343"})))))}};h.style=l;const d=":host{display:block}";const u=d;const f=class{constructor(e){t(this,e);this.API_URL="http://localhost:2989";this.currentCatId=2;this.runes=[];this.items=[];this.focusFilterRuneId=0;this.rootCategories=[];this.orderDirection="DESC";this.propToSortOn=undefined;this.refresh=false}async componentWillLoad(){try{const t=await this.fetchFromApi("/items/equipments/7?offset=0&limit=500");const e=await this.fetchFromApi("/items/equipments/7?offset=500&limit=500");this.runes=await this.fetchFromApi("/items/runes");this.rootCategories=await this.fetchFromApi("/rootCategories");this.items=await this.processItems(t.concat(e));this.items=this.items.filter((t=>!isNaN(t.breakableRate)))}catch(t){console.error("Error fetching items:",t)}}async processItems(t){return Promise.all(t.map((async t=>{if(!t.ResultRecipes||!t.characteristics)return t;t.totalCraftPrice=this.calculateCraftPrice(t);t._runeDetails=this.calculateRuneDetails(t);this.setLowestBreakableRate(t);this.setBenefice(t);return t})))}async changeCategory(t){const e=await this.fetchFromApi(`/items/equipments/${t}?offset=0&limit=500`);const i=await this.fetchFromApi(`/items/equipments/${t}?offset=500&limit=500`);this.items=await this.processItems(e.concat(i));this.items=this.items.filter((t=>!isNaN(t.breakableRate)))}calculateCraftPrice(t){return t.ResultRecipes.reduce(((t,e)=>t+e.Ingredients.reduce(((t,e)=>{var i,s,a;const o=((a=(s=(i=e.Ingredient)===null||i===void 0?void 0:i.averagePrices)===null||s===void 0?void 0:s[0])===null||a===void 0?void 0:a.averagePrice)||0;return t+o*e.quantity}),0)),0)}calculateRuneDetails(t){const e=[];let i=0;let s=0;let a=0;let o;t.characteristics.forEach((n=>{var c;if(n.from<0||!((c=n.characteristic)===null||c===void 0?void 0:c.runes))return;n.characteristic.runes.forEach((c=>{var r,l,h,d;const u=c.density||1;const f=((h=(l=(r=c.rune)===null||r===void 0?void 0:r.averagePrices)===null||l===void 0?void 0:l[0])===null||h===void 0?void 0:h.averagePrice)||0;const p=n.to?(n.from+n.to)/2:n.from;const b=(3*p*u*t.lvl/200+1)/Math.max(u,1);const m=b*f;i+=m;const v=this.calculateFocusPdb(t,n,u);const y=v*f;if(y>a){a=y;o=c}s=Math.max(s,y);e.push({type:((d=c.rune)===null||d===void 0?void 0:d.name)||"Unknown Rune",quantityFocus:v,quantityNoFocus:b,priceFocus:y,priceNoFocus:m,focusedCharacteristic:n.characteristic.name})}))}));t.totalRunePrice=i;t.totalFocusRunePrice=s;t.bestCharToFocus=o;return e}calculateFocusPdb(t,e,i){return t.characteristics.reduce(((i,s)=>{var a;if(s.from<0)return i;const o=s.to?(s.from+s.to)/2:s.from;const n=3*o*(((a=s.characteristic.runes[0])===null||a===void 0?void 0:a.density)||1)*t.lvl/200+1;return i+(s.characteristic.id===e.characteristic.id?n:n*.5)}),0)/Math.max(i,1)}setLowestBreakableRate(t){const e=t.totalCraftPrice/t.totalFocusRunePrice;const i=t.totalCraftPrice/t.totalRunePrice;const s=Math.min(e,i);t.breakableRate=s;t.minBreakableRateFocus=e;t.minBreakableRateNoFocus=i;t._runeDetails.forEach((t=>{t.quantityFocus*=s;t.quantityNoFocus*=s;t.priceFocus*=s;t.priceNoFocus*=s}))}setBenefice(t){const e=t.totalFocusRunePrice-t.totalCraftPrice;const i=t.totalRunePrice-t.totalCraftPrice;t.benefit=Math.max(e,i);t.benefitPercentage=t.totalCraftPrice>0?t.benefit/t.totalCraftPrice*100:0}async fetchFromApi(t){const e=await fetch(this.API_URL+t);if(!e.ok){throw new Error(`HTTP error! Status: ${e.status}`)}return await e.json()}sortItems(){if(this.orderDirection==="DESC"){return this.items.sort(((t,e)=>e[this.propToSortOn]-t[this.propToSortOn]))}else if(this.orderDirection==="ASC"){return this.items.sort(((t,e)=>t[this.propToSortOn]-e[this.propToSortOn]))}else return this.items}sortByFocusedChar(){if(this.focusFilterRuneId==0)return this.sortItems();return this.sortItems().filter((t=>{var e,i;return((i=(e=t.bestCharToFocus)===null||e===void 0?void 0:e.rune)===null||i===void 0?void 0:i.id)==this.focusFilterRuneId}))}render(){var t;return e("div",{key:"adb4b228b5c2ae9f6b44f1ed51d0c1658d54a547",class:"items-list"},e("h1",{key:"719e2227efac5b7ce567efb5d71c44b1e2c497e3"},"Items with Exact Prices and Rune Details"),e("select",{key:"504fe1eba7cb71e4f001d95e49a5ca5600bad4ac",onChange:t=>this.changeCategory(t.target.value)},this.rootCategories.map((t=>e("option",{value:t.id},t.name)))),e("select",{key:"1faff1b91516e5610013c04dea24a9028d9ad806",onChange:t=>this.propToSortOn=t.target.value},e("option",{key:"7e30aadbba40512861fcee8f3bddb46c0a27cbde",value:"breakableRate"},"Coeff"),e("option",{key:"9b05c4f879b84be59739a6c25a4239571c415128",value:"totalCraftPrice"},"Crafting Price")),e("select",{key:"0f2c9b06a0867629559f86a91c9e8158f2cff94d",onChange:t=>{this.orderDirection=t.target.value}},e("option",{key:"375d7c3c20546ff2b9e2a374d369350a83406c3c",value:"DESC"},"DESC"),e("option",{key:"28ad4201734794cf5edf648327980bf0392d70f8",value:"ASC"},"ASC")),e("select",{key:"d177c2314c8f108b978e44cb860fd4537c1f3726",onChange:t=>{this.focusFilterRuneId=t.target.value}},e("option",{key:"6fe849bc0d2e7579634e54dd070579ad5c4c0eeb",value:0},"No filter"),this.runes.map((t=>e("option",{value:t.id},t.name)))),((t=this.items)===null||t===void 0?void 0:t.length)===0?e("p",null,"Loading items..."):e("table",{class:"table"},e("thead",null,e("tr",null,e("th",null,"Item Name"),e("th",null,"Craft Cost"),e("th",null,"Focus"),e("th",null,"Minimum Break Coefficient"),e("th",null,"Rune Details"))),e("tbody",null,this.sortByFocusedChar().map((t=>{var i;return t.totalCraftPrice>0&&e("tr",{key:t.id},e("td",null,t.name," : ",(i=t.category)===null||i===void 0?void 0:i.name," - lvl ",t.lvl),e("td",null,t.totalCraftPrice.toFixed(0)),e("td",null,t.minBreakableRateFocus>t.minBreakableRateNoFocus?"No Focus":"Focus"),e("td",null,(Math.min(t.minBreakableRateFocus,t.minBreakableRateNoFocus)*100).toFixed(0)),e("td",null,t._runeDetails.length>0?e("ul",null,t._runeDetails.map((t=>e("li",{key:t.type},t.type,":",e("ul",null,e("li",null,"Quantity Focus: ",t.quantityFocus.toFixed(1)," (Total: ",t.priceFocus.toFixed(2),")"),e("li",null,"Quantity No Focus: ",t.quantityNoFocus.toFixed(1)," (Total: ",t.priceNoFocus.toFixed(2),")")))))):"N/A"))})))))}};f.style=u;export{n as app_home,h as app_root,f as item_recipe_component};
//# sourceMappingURL=p-5225ff0f.entry.js.map